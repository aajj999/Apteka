<!DOCTYPE html>
<html lang="en">
<head>
<title>System wyszukujÄ…cy leki refundowane</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css">
	<meta charset="UTF-8">
</head>

<body>
	<input type="text" placeholder="Wyszukaj..." id="Textfield">
    <button type="button" onclick="search();">Szukaj</button>

    <script>
	const part = 40
	
	const atributes = 9;
	
	function test() {
		table = [[{value: "asdf", span: 1}, {value: "fdsa", span: 1}, {value: "tabletkii", span: 4}, {value: "duza", span: 1}, {value: 1235, span: 1}, {value: "100%", span: 1}, {value: "sadf", span: 2}, {value: "zaraza", span: 1}, {value: 10, span: 1}], [{value: "asdf2", span: 1}, {value: "fdsa2", span: 1}, {value: "tabletkii", span: 0}, {value: "duza", span: 1}, {value: 1235, span: 1}, {value: "100%", span: 1}, {value: "sadf", span: 0}, {value: "zaraza", span: 1}, {value: 10, span: 1}], [{value: "asdf3", span: 1}, {value: "fdsa", span: 1}, {value: "tabletkii", span: 0}, {value: "duza", span: 1}, {value: 1235, span: 1}, {value: "100%", span: 1}, {value: "sadf", span: 2}, {value: "zaraza", span: 1}, {value: 10, span: 1}], [{value: "asdf4", span: 1}, {value: "fdsa2", span: 1}, {value: "tabletkii", span: 0}, {value: "duza", span: 1}, {value: 1235, span: 1}, {value: "100%", span: 1}, {value: "sadf", span: 0}, {value: "zaraza", span: 1}, {value: 10, span: 1}]];;
		page = 0;
			var pagnum = Math.ceil(table.length / part);
			var box = document.getElementById("Buttons");
			while (box.firstChild) 
			 {
				box.removeChild(box.firstChild);
			 }
			for(var i = 0; i < pagnum; i++) {
				  var btn = document.createElement("BUTTON");
				  btn.innerHTML = i;
				  document.getElementById("Buttons").appendChild(btn);
				  btn.onclick = function() {scroll(this)};
			}
			for(var j = 0; j < atributes; j++) {
				for(var i = 0; i < table.length; i++) {
					if(i % part == 0) {
						var x = i;
						while(table[x][j].span == 0)
							x--;
						if(x != i) {
							table[i][j].span = table[x][j].span - (i - x);
							table[x][j].span = i - x;
						}
					}
				}
			}
			redraw();
	}
	
	var table;
	var page = 0;
	
	function redraw() {
	  var box = document.getElementById("tables");
			while (box.firstChild) 
			 {
				box.removeChild(box.firstChild);
			 }
	  var tbl = document.createElement('table');
	  tbl.style.width = '100%';
	  tbl.setAttribute('border', '1');
	  var tbdy = document.createElement('tbody');
	  var labels = document.createElement('tr');
	  var etiquettes = ["Name", "Substance", "Form", "Dose", "Content", "EAN", "Refundation", "Scope", "Price"];
	  for (var j = 0; j < atributes; j++) {
		var th = document.createElement('th');
		th.appendChild(document.createTextNode(etiquettes[j]));
		labels.appendChild(th);
	  }
	  tbl.appendChild(labels);
	  for (var i = page * part; i < Math.min((page + 1) * part, table.length); i++) {
		var tr = document.createElement('tr');
		for (var j = 0; j < atributes; j++) {
		  if(table[i][j].span > 0){
			var td = document.createElement('td');
			td.appendChild(document.createTextNode(table[i][j].value));
			td.setAttribute('rowSpan', table[i][j].span);
			tr.appendChild(td);
		  }
		}
		tbdy.appendChild(tr);
	  }
	  tbl.appendChild(tbdy);
	  box.appendChild(tbl);
	}
	
	function search() {
		alert(window.location.href + "find?q=" + document.getElementById("Textfield").value);
		$.getJSON(window.location.href + "find?q=" + document.getElementById("Textfield").value, function(t) {
			table = t;
			page = 0;
			var pagnum = Math.ceil(table.length / part);
			var box = document.getElementById("Buttons");
			while (box.firstChild) 
			 {
				box.removeChild(box.firstChild);
			 }
			for(var i = 0; i < pagnum; i++) {
				  var btn = document.createElement("BUTTON");
				  btn.innerHTML = i;
				  document.getElementById("Buttons").appendChild(btn);
				  btn.onclick = function() {scroll(this)};
			}
			for(var j = 0; j < atributes; j++) {
				for(var i = 0; i < table.length; i++) {
					if(i % part == 0) {
						var x = i;
						while(table[x][j].span == 0)
							x--;
						if(x != i) {
							table[i][j].span = table[x][j].span - (i - x);
							table[x][j].span = i - x;
						}
					}
				}
			}
			redraw();
		});
	}
	
	function scroll(btn) {
		page = parseInt(btn.innerHTML);
		redraw();
	}
    </script>
	<div id="tables"><b>Currently no results.</b></div>
    <footer><div id="Buttons" style="vertical-align: bottom"></div></footer>
</body>
</html>